{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\amand\\\\OneDrive\\\\Desktop\\\\Social\\\\create-social-network\\\\hellobaby\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _toConsumableArray from \"C:\\\\Users\\\\amand\\\\OneDrive\\\\Desktop\\\\Social\\\\create-social-network\\\\hellobaby\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\amand\\\\OneDrive\\\\Desktop\\\\Social\\\\create-social-network\\\\hellobaby\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\Users\\\\amand\\\\OneDrive\\\\Desktop\\\\Social\\\\create-social-network\\\\hellobaby\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\amand\\\\OneDrive\\\\Desktop\\\\Social\\\\create-social-network\\\\hellobaby\\\\frontend\\\\src\\\\components\\\\App\\\\App.js\";\nimport React, { useEffect } from 'react';\nimport { useQuery } from '@apollo/react-hooks';\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport { GlobalStyle } from './GlobalStyles';\nimport { GET_AUTH_USER } from 'graphql/user';\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\nimport { NOTIFICATION_CREATED_OR_DELETED } from 'graphql/notification';\nimport Message from 'components/Message';\nimport { Loading } from 'components/Loading';\nimport AuthLayout from 'pages/Auth/AuthLayout';\nimport AppLayout from './AppLayout';\nimport ScrollToTop from './ScrollToTop';\nimport { useStore } from 'store';\n/**\r\n * Root component of the app\r\n */\n\nvar App = function App() {\n  var _useStore = useStore(),\n      _useStore2 = _slicedToArray(_useStore, 1),\n      message = _useStore2[0].message;\n\n  var _useQuery = useQuery(GET_AUTH_USER),\n      loading = _useQuery.loading,\n      subscribeToMore = _useQuery.subscribeToMore,\n      data = _useQuery.data,\n      refetch = _useQuery.refetch;\n\n  useEffect(function () {\n    var unsubscribe = subscribeToMore({\n      document: NOTIFICATION_CREATED_OR_DELETED,\n      updateQuery: function () {\n        var _updateQuery = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(prev, _ref) {\n          var subscriptionData, oldNotifications, _subscriptionData$dat, operation, notification, newNotifications, notifications, index, authUser;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  subscriptionData = _ref.subscriptionData;\n\n                  if (subscriptionData.data) {\n                    _context.next = 3;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\", prev);\n\n                case 3:\n                  oldNotifications = prev.getAuthUser.newNotifications;\n                  _subscriptionData$dat = subscriptionData.data.notificationCreatedOrDeleted, operation = _subscriptionData$dat.operation, notification = _subscriptionData$dat.notification;\n\n                  if (!(operation === 'CREATE')) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  if (!(window.location.href.split('/')[3] === 'notifications')) {\n                    _context.next = 8;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\", prev);\n\n                case 8:\n                  // Add new notification\n                  newNotifications = [notification].concat(_toConsumableArray(oldNotifications));\n                  _context.next = 15;\n                  break;\n\n                case 11:\n                  // Remove from notifications\n                  notifications = oldNotifications;\n                  index = notifications.findIndex(function (n) {\n                    return n.id === notification.id;\n                  });\n\n                  if (index > -1) {\n                    notifications.splice(index, 1);\n                  }\n\n                  newNotifications = notifications;\n\n                case 15:\n                  // Attach new notifications to authUser\n                  authUser = prev.getAuthUser;\n                  authUser.newNotifications = newNotifications;\n                  return _context.abrupt(\"return\", {\n                    getAuthUser: authUser\n                  });\n\n                case 18:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function updateQuery(_x, _x2) {\n          return _updateQuery.apply(this, arguments);\n        }\n\n        return updateQuery;\n      }()\n    });\n    return function () {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n  useEffect(function () {\n    var unsubscribe = subscribeToMore({\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\n      updateQuery: function updateQuery(prev, _ref2) {\n        var subscriptionData = _ref2.subscriptionData;\n        if (!subscriptionData.data) return prev;\n        var oldConversations = prev.getAuthUser.newConversations;\n        var newConversation = subscriptionData.data.newConversation; // Don't show message notification in Header if user already is on messages page\n\n        if (window.location.href.split('/')[3] === 'messages') {\n          return prev;\n        } // If authUser already has unseen message from that user,\n        // remove old message, so we can show the new one\n\n\n        var index = oldConversations.findIndex(function (u) {\n          return u.id === newConversation.id;\n        });\n\n        if (index > -1) {\n          oldConversations.splice(index, 1);\n        } // Merge conversations\n\n\n        var mergeConversations = [newConversation].concat(_toConsumableArray(oldConversations)); // Attach new conversation to authUser\n\n        var authUser = prev.getAuthUser;\n        authUser.newConversations = mergeConversations;\n        return {\n          getAuthUser: authUser\n        };\n      }\n    });\n    return function () {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n  if (loading) return React.createElement(Loading, {\n    top: \"xl\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  });\n  return React.createElement(Router, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, React.createElement(GlobalStyle, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }), React.createElement(ScrollToTop, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, data.getAuthUser ? React.createElement(Route, {\n    exact: true,\n    render: function render() {\n      return React.createElement(AppLayout, {\n        authUser: data.getAuthUser,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }) : React.createElement(Route, {\n    exact: true,\n    render: function render() {\n      return React.createElement(AuthLayout, {\n        refetch: refetch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }))), message.content.text && React.createElement(Message, {\n    type: message.content.type,\n    autoClose: message.content.autoClose,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, message.content.text));\n};\n\nexport default App;","map":{"version":3,"sources":["C:/Users/amand/OneDrive/Desktop/Social/create-social-network/hellobaby/frontend/src/components/App/App.js"],"names":["React","useEffect","useQuery","BrowserRouter","Router","Route","Switch","GlobalStyle","GET_AUTH_USER","GET_NEW_CONVERSATIONS_SUBSCRIPTION","NOTIFICATION_CREATED_OR_DELETED","Message","Loading","AuthLayout","AppLayout","ScrollToTop","useStore","App","message","loading","subscribeToMore","data","refetch","unsubscribe","document","updateQuery","prev","subscriptionData","oldNotifications","getAuthUser","newNotifications","notificationCreatedOrDeleted","operation","notification","window","location","href","split","notifications","index","findIndex","n","id","splice","authUser","oldConversations","newConversations","newConversation","u","mergeConversations","content","text","type","autoClose"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useQuery } from '@apollo/react-hooks';\r\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\r\n\r\nimport { GlobalStyle } from './GlobalStyles';\r\n\r\nimport { GET_AUTH_USER } from 'graphql/user';\r\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\r\nimport { NOTIFICATION_CREATED_OR_DELETED } from 'graphql/notification';\r\n\r\nimport Message from 'components/Message';\r\nimport { Loading } from 'components/Loading';\r\nimport AuthLayout from 'pages/Auth/AuthLayout';\r\nimport AppLayout from './AppLayout';\r\nimport ScrollToTop from './ScrollToTop';\r\n\r\nimport { useStore } from 'store';\r\n\r\n/**\r\n * Root component of the app\r\n */\r\nconst App = () => {\r\n  const [{ message }] = useStore();\r\n\r\n  const { loading, subscribeToMore, data, refetch } = useQuery(GET_AUTH_USER);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeToMore({\r\n      document: NOTIFICATION_CREATED_OR_DELETED,\r\n      updateQuery: async (prev, { subscriptionData }) => {\r\n        if (!subscriptionData.data) return prev;\r\n\r\n        const oldNotifications = prev.getAuthUser.newNotifications;\r\n        const {\r\n          operation,\r\n          notification,\r\n        } = subscriptionData.data.notificationCreatedOrDeleted;\r\n\r\n        let newNotifications;\r\n\r\n        if (operation === 'CREATE') {\r\n          // Don't show message notification in Header if user already is on notifications page\r\n          if (window.location.href.split('/')[3] === 'notifications') {\r\n            return prev;\r\n          }\r\n\r\n          // Add new notification\r\n          newNotifications = [notification, ...oldNotifications];\r\n        } else {\r\n          // Remove from notifications\r\n          const notifications = oldNotifications;\r\n          const index = notifications.findIndex(n => n.id === notification.id);\r\n          if (index > -1) {\r\n            notifications.splice(index, 1);\r\n          }\r\n\r\n          newNotifications = notifications;\r\n        }\r\n\r\n        // Attach new notifications to authUser\r\n        const authUser = prev.getAuthUser;\r\n        authUser.newNotifications = newNotifications;\r\n\r\n        return { getAuthUser: authUser };\r\n      },\r\n    });\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [subscribeToMore]);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeToMore({\r\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\r\n      updateQuery: (prev, { subscriptionData }) => {\r\n        if (!subscriptionData.data) return prev;\r\n\r\n        const oldConversations = prev.getAuthUser.newConversations;\r\n        const { newConversation } = subscriptionData.data;\r\n\r\n        // Don't show message notification in Header if user already is on messages page\r\n        if (window.location.href.split('/')[3] === 'messages') {\r\n          return prev;\r\n        }\r\n\r\n        // If authUser already has unseen message from that user,\r\n        // remove old message, so we can show the new one\r\n        const index = oldConversations.findIndex(\r\n          u => u.id === newConversation.id\r\n        );\r\n        if (index > -1) {\r\n          oldConversations.splice(index, 1);\r\n        }\r\n\r\n        // Merge conversations\r\n        const mergeConversations = [newConversation, ...oldConversations];\r\n\r\n        // Attach new conversation to authUser\r\n        const authUser = prev.getAuthUser;\r\n        authUser.newConversations = mergeConversations;\r\n\r\n        return { getAuthUser: authUser };\r\n      },\r\n    });\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [subscribeToMore]);\r\n\r\n  if (loading) return <Loading top=\"xl\" />;\r\n\r\n  return (\r\n    <Router>\r\n      <GlobalStyle />\r\n\r\n      <ScrollToTop>\r\n        <Switch>\r\n          {data.getAuthUser ? (\r\n            <Route\r\n              exact\r\n              render={() => <AppLayout authUser={data.getAuthUser} />}\r\n            />\r\n          ) : (\r\n            <Route exact render={() => <AuthLayout refetch={refetch} />} />\r\n          )}\r\n        </Switch>\r\n      </ScrollToTop>\r\n\r\n      {message.content.text && (\r\n        <Message\r\n          type={message.content.type}\r\n          autoClose={message.content.autoClose}\r\n        >\r\n          {message.content.text}\r\n        </Message>\r\n      )}\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}